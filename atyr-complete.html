<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATYR Fashion Mix & Match</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #fafafa; 
            min-height: 100vh; 
            color: #333;
            overflow-x: hidden;
        }
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            padding: 20px;
        }
        .header { 
            text-align: center; 
            margin-bottom: 2rem; 
        }
        .welcome-message {
            background: white;
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 4px solid #9CAF88;
        }
        .welcome-text {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .welcome-name {
            font-size: 1.6rem;
            font-weight: 600;
            color: #333;
        }
        .title { 
            font-size: 2.5rem; 
            font-weight: 300; 
            margin-bottom: 0.5rem; 
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }
        .subtitle { 
            font-size: 1rem; 
            color: #666; 
            font-weight: 400;
        }
        
        /* Stats Bar */
        .stats-bar {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .stat-item {
            flex: 1;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #9CAF88;
            display: block;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* AI Search Bar */
        .ai-search-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 4px solid #9CAF88;
        }
        .ai-search-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }
        .ai-search-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .ai-search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .ai-search-input:focus {
            outline: none;
            border-color: #9CAF88;
            box-shadow: 0 0 0 3px rgba(156,175,136,0.1);
        }
        .ai-search-btn {
            background: #9CAF88;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ai-search-btn:hover {
            background: #8BA077;
            transform: translateY(-2px);
        }
        .ai-search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .outfit-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin: 2rem 0;
            position: relative;
        }
        
        /* Unified Carousel Design */
        .unified-carousel {
            background: white;
            border-radius: 20px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.08);
            overflow: hidden;
            max-width: 400px;
            width: 100%;
            position: relative;
        }
        
        .carousel-section {
            position: relative;
        }
        
        .carousel-wrapper {
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        
        .carousel {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }
        
        .carousel-item {
            flex: 0 0 100%;
            height: 280px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            transition: transform 0.3s ease;
            background: #f8f9fa;
        }
        
        .carousel-item:hover img {
            transform: scale(1.05);
        }
        
        .carousel-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(0,0,0,0.3));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }
        
        .carousel-item:hover::before {
            opacity: 1;
        }
        
        .carousel-item:hover .item-details {
            opacity: 1;
            transform: translateY(0);
        }
        
        .item-details {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 1.5rem;
            transform: translateY(100%);
            transition: all 0.3s ease;
            opacity: 0;
            z-index: 2;
        }
        
        .item-name {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }
        
        .item-brand {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .item-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: #9CAF88;
        }
        
        .nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #333;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .nav-button:hover {
            background: #9CAF88;
            color: white;
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(156,175,136,0.3);
        }
        
        .nav-button.prev {
            left: -20px;
        }
        
        .nav-button.next {
            right: -20px;
        }
        
        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Action Buttons - Moved closer */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem 0;
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
        }
        
        .action-btn {
            background: white;
            border: 2px solid #9CAF88;
            color: #9CAF88;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .action-btn:hover {
            background: #9CAF88;
            color: white;
            transform: scale(1.1);
        }
        
        .buy-button {
            background: #9CAF88;
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            margin: 2rem auto;
            display: block;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 8px 24px rgba(156,175,136,0.3);
        }
        
        .buy-button:hover {
            background: #8BA077;
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(156,175,136,0.4);
        }
        
        .buy-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .total-price {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin: 1rem 0;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border-left: 4px solid #9CAF88;
        }
        
        /* AI Speech Bubble */
        .ai-speech-bubble {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #9CAF88, #8BA077);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            max-width: 300px;
            box-shadow: 0 8px 32px rgba(156,175,136,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
        }
        
        .ai-speech-bubble.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .ai-speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #8BA077;
        }
        
        .ai-speech-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .ai-speech-close {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
        }
        
        .ai-speech-close:hover {
            opacity: 1;
        }
        
        /* AI Recommendation Display */
        .ai-recommendation {
            background: linear-gradient(135deg, #9CAF88, #8BA077);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            display: none;
        }
        
        .ai-recommendation.show {
            display: block;
        }
        
        .ai-recommendation h4 {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .ai-recommendation p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                position: static;
                flex-direction: row;
                justify-content: center;
                margin: 1rem 0;
            }
            
            .unified-carousel {
                max-width: 320px;
            }
            
            .carousel-item {
                height: 250px;
            }
            
            .nav-button {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }
            
            .nav-button.prev {
                left: -18px;
            }
            
            .nav-button.next {
                right: -18px;
            }
            
            .ai-speech-bubble {
                bottom: 10px;
                right: 10px;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="welcome-message">
                <div class="welcome-text">Welcome back,</div>
                <div class="welcome-name" id="userName">Gourav</div>
            </div>
            <h1 class="title">ATYR</h1>
            <p class="subtitle">Mix & Match</p>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-number" id="combosCreated">0</span>
                <span class="stat-label">Combos Created</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="itemsViewed">0</span>
                <span class="stat-label">Items Viewed</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="timeSpent">0m</span>
                <span class="stat-label">Time Spent</span>
            </div>
        </div>

        <!-- AI Search Bar -->
        <div class="ai-search-container">
            <div class="ai-search-title"> AI Style Assistant</div>
            <div class="ai-search-bar">
                <input type="text" class="ai-search-input" id="aiSearchInput" placeholder="Tell me where you're heading... (e.g., weekend concert, business meeting, date night)">
                <button class="ai-search-btn" id="aiSearchBtn">
                    <span></span>
                    <span>Get AI Recommendation</span>
                </button>
            </div>
        </div>

        <!-- AI Recommendation Display -->
        <div class="ai-recommendation" id="aiRecommendation">
            <h4> AI Recommendation</h4>
            <p id="aiRecommendationText"></p>
        </div>

        <div class="outfit-container">
            <div class="unified-carousel">
                <!-- Top Carousel -->
                <div class="carousel-section">
                    <button class="nav-button prev" id="topPrev"></button>
                    <div class="carousel-wrapper">
                        <div class="carousel" id="topsCarousel">
                            <div class="carousel-item" data-name="White T-Shirt" data-brand="ATYR" data-price="29.99" data-description="Classic white cotton t-shirt with a relaxed fit. Perfect for everyday wear and easy to style." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Adobe Express - file (1).png" alt="White T-Shirt">
                                <div class="item-details">
                                    <div class="item-name">White T-Shirt</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$29.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Striped Top" data-brand="ATYR" data-price="45.99" data-description="Elegant striped top with a modern silhouette. Made from premium materials for comfort and style." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (10).png" alt="Striped Top">
                                <div class="item-details">
                                    <div class="item-name">Striped Top</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$45.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Button Up" data-brand="ATYR" data-price="39.99" data-description="Versatile button-up shirt that transitions from casual to formal. Crisp and clean design." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (11).png" alt="Button Up">
                                <div class="item-details">
                                    <div class="item-name">Button Up</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$39.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Blouse" data-brand="ATYR" data-price="55.99" data-description="Sophisticated blouse with delicate details. Perfect for professional settings or special occasions." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (12).png" alt="Blouse">
                                <div class="item-details">
                                    <div class="item-name">Blouse</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$55.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Tank Top" data-brand="ATYR" data-price="24.99" data-description="Essential tank top for layering or wearing alone. Soft fabric with a comfortable fit." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (3).png" alt="Tank Top">
                                <div class="item-details">
                                    <div class="item-name">Tank Top</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$24.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Shirt" data-brand="ATYR" data-price="49.99" data-description="Classic shirt with a modern twist. Versatile piece that works for any occasion." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (5).png" alt="Shirt">
                                <div class="item-details">
                                    <div class="item-name">Shirt</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$49.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Trendy Top" data-brand="ATYR" data-price="34.99" data-description="Fashion-forward top with contemporary styling. Stand out with this unique piece." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (7).png" alt="Trendy Top">
                                <div class="item-details">
                                    <div class="item-name">Trendy Top</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$34.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Fashion Top" data-brand="ATYR" data-price="42.99" data-description="Stylish top designed for the modern wardrobe. Quality construction meets contemporary design." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project.png" alt="Fashion Top">
                                <div class="item-details">
                                    <div class="item-name">Fashion Top</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$42.99</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="nav-button next" id="topNext"></button>
                </div>

                <!-- Bottom Carousel -->
                <div class="carousel-section">
                    <button class="nav-button prev" id="bottomPrev"></button>
                    <div class="carousel-wrapper">
                        <div class="carousel" id="bottomsCarousel">
                            <div class="carousel-item" data-name="Jeans" data-brand="ATYR" data-price="79.99" data-description="Classic denim jeans with a perfect fit. Durable and comfortable for everyday wear." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (1).png" alt="Jeans">
                                <div class="item-details">
                                    <div class="item-name">Jeans</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$79.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Chinos" data-brand="ATYR" data-price="65.99" data-description="Smart chinos that bridge casual and formal. Perfect for business casual settings." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (13).png" alt="Chinos">
                                <div class="item-details">
                                    <div class="item-name">Chinos</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$65.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Trousers" data-brand="ATYR" data-price="59.99" data-description="Elegant trousers with a tailored fit. Professional and sophisticated styling." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (14).png" alt="Trousers">
                                <div class="item-details">
                                    <div class="item-name">Trousers</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$59.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Pants" data-brand="ATYR" data-price="89.99" data-description="Premium pants with exceptional quality. Designed for comfort and style." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (2).png" alt="Pants">
                                <div class="item-details">
                                    <div class="item-name">Pants</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$89.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Shorts" data-brand="ATYR" data-price="39.99" data-description="Comfortable shorts perfect for warm weather. Casual and versatile design." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (4).png" alt="Shorts">
                                <div class="item-details">
                                    <div class="item-name">Shorts</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$39.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Skirt" data-brand="ATYR" data-price="49.99" data-description="Elegant skirt with a flattering silhouette. Perfect for both casual and formal occasions." data-sizes="XS,S,M,L,XL">
                                <img src="backend/uploads/Remove background project (6).png" alt="Skirt">
                                <div class="item-details">
                                    <div class="item-name">Skirt</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$49.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Trendy Pants" data-brand="ATYR" data-price="69.99" data-description="Modern pants with contemporary styling. Stand out with this fashion-forward piece." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (8).png" alt="Trendy Pants">
                                <div class="item-details">
                                    <div class="item-name">Trendy Pants</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$69.99</div>
                                </div>
                            </div>
                            <div class="carousel-item" data-name="Fashion Bottoms" data-brand="ATYR" data-price="54.99" data-description="Stylish bottoms that complete any outfit. Quality meets contemporary design." data-sizes="28,30,32,34,36">
                                <img src="backend/uploads/Remove background project (9).png" alt="Fashion Bottoms">
                                <div class="item-details">
                                    <div class="item-name">Fashion Bottoms</div>
                                    <div class="item-brand">ATYR</div>
                                    <div class="item-price">$54.99</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="nav-button next" id="bottomNext"></button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn" id="randomCombo" title="Random Combo"></button>
                <button class="action-btn" id="saveCombo" title="Save Combo"></button>
                <button class="action-btn" id="shareCombo" title="Share Combo"></button>
            </div>
        </div>

        <div class="total-price" id="totalPrice" style="display: none;"></div>
        <button class="buy-button" id="buyButton" disabled>Buy Together</button>
    </div>

    <!-- AI Speech Bubble -->
    <div class="ai-speech-bubble" id="aiSpeechBubble">
        <button class="ai-speech-close" id="closeSpeechBubble"></button>
        <div class="ai-speech-text" id="aiSpeechText"></div>
    </div>

    <script>
        // GROQ API Configuration
        const GROQ_API_KEY = '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';
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

        // Stats tracking
        let stats = {
            combosCreated: 0,
            itemsViewed: 0,
            timeSpent: 0
        };

        // AI Speech Bubble prompts
        const aiPrompts = [
            "Ooh la la! This combo would be perfect for a party! ",
            "Wow, you'd look amazing in this! ",
            "This screams girlboss energy! ",
            "Perfect for Toronto weather! ",
            "This combo is giving main character energy! ",
            "So chic and sophisticated! ",
            "This would turn heads at any event! ",
            "Absolutely stunning combination! ",
            "This screams confidence! ",
            "Perfect for a coffee date! "
        ];

        class Carousel {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.currentIndex = 0;
                this.items = this.container.querySelectorAll('.carousel-item');
                this.totalItems = this.items.length;
                
                this.init();
            }

            init() {
                this.updateCarousel();
                this.addClickListeners();
            }

            addClickListeners() {
                this.items.forEach(item => {
                    item.addEventListener('click', () => this.openModal(item));
                });
            }

            openModal(item) {
                // Track item view
                stats.itemsViewed++;
                updateStats();
                
                // Show random AI prompt
                showRandomAIPrompt();
            }

            next() {
                this.currentIndex = (this.currentIndex + 1) % this.totalItems;
                this.updateCarousel();
                stats.itemsViewed++;
                updateStats();
            }

            prev() {
                this.currentIndex = (this.currentIndex - 1 + this.totalItems) % this.totalItems;
                this.updateCarousel();
                stats.itemsViewed++;
                updateStats();
            }

            goToItem(itemName) {
                const itemIndex = Array.from(this.items).findIndex(item => 
                    item.dataset.name.toLowerCase().includes(itemName.toLowerCase())
                );
                if (itemIndex !== -1) {
                    this.currentIndex = itemIndex;
                    this.updateCarousel();
                }
            }

            updateCarousel() {
                const translateX = -this.currentIndex * 100;
                this.container.style.transform = `translateX(${translateX}%)`;
            }

            getCurrentItem() {
                return this.items[this.currentIndex];
            }
        }

        // Initialize carousels
        const topCarousel = new Carousel('topsCarousel');
        const bottomCarousel = new Carousel('bottomsCarousel');

        // Add event listeners
        document.getElementById('topPrev').addEventListener('click', () => topCarousel.prev());
        document.getElementById('topNext').addEventListener('click', () => topCarousel.next());
        document.getElementById('bottomPrev').addEventListener('click', () => bottomCarousel.prev());
        document.getElementById('bottomNext').addEventListener('click', () => bottomCarousel.next());

        // AI Recommendation Function (Fixed)
        async function getAIRecommendation(query) {
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-70b-versatile',
                        messages: [{
                            role: 'user',
                            content: `You are a fashion expert. Recommend the best clothing combination for: "${query}"
                            
                            Available items:
                            Tops: White T-Shirt, Striped Top, Button Up, Blouse, Tank Top, Shirt, Trendy Top, Fashion Top
                            Bottoms: Jeans, Chinos, Trousers, Pants, Shorts, Skirt, Trendy Pants, Fashion Bottoms
                            
                            Respond with ONLY this JSON format: {"top": "exact item name", "bottom": "exact item name", "reason": "brief explanation"}`
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Try to parse JSON from the response
                const jsonMatch = content.match(/\{.*\}/s);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    // Fallback parsing
                    return {
                        top: "Button Up",
                        bottom: "Chinos", 
                        reason: "A classic business casual look that works for most professional settings."
                    };
                }
            } catch (error) {
                console.error('AI Recommendation Error:', error);
                // Fallback recommendation
                return {
                    top: "White T-Shirt",
                    bottom: "Jeans",
                    reason: "A timeless casual combination that works for any occasion."
                };
            }
        }

        // AI Search functionality
        document.getElementById('aiSearchBtn').addEventListener('click', async () => {
            const query = document.getElementById('aiSearchInput').value.trim();
            if (!query) return;

            const btn = document.getElementById('aiSearchBtn');
            btn.disabled = true;
            btn.innerHTML = '<span></span><span>Analyzing...</span>';

            try {
                const recommendation = await getAIRecommendation(query);
                
                if (recommendation) {
                    // Show recommendation
                    document.getElementById('aiRecommendationText').textContent = 
                        `For ${query}, I recommend: ${recommendation.top} + ${recommendation.bottom}. ${recommendation.reason}`;
                    document.getElementById('aiRecommendation').classList.add('show');

                    // Navigate to recommended items
                    setTimeout(() => {
                        topCarousel.goToItem(recommendation.top);
                        bottomCarousel.goToItem(recommendation.bottom);
                    }, 1000);
                }
            } catch (error) {
                alert('Error getting AI recommendation. Please try again.');
            }

            btn.disabled = false;
            btn.innerHTML = '<span></span><span>Get AI Recommendation</span>';
        });

        // AI Speech Bubble functions
        function showRandomAIPrompt() {
            const bubble = document.getElementById('aiSpeechBubble');
            const text = document.getElementById('aiSpeechText');
            
            const randomPrompt = aiPrompts[Math.floor(Math.random() * aiPrompts.length)];
            text.textContent = randomPrompt;
            
            bubble.classList.add('show');
            
            // Auto hide after 4 seconds
            setTimeout(() => {
                bubble.classList.remove('show');
            }, 4000);
        }

        // Close speech bubble
        document.getElementById('closeSpeechBubble').addEventListener('click', () => {
            document.getElementById('aiSpeechBubble').classList.remove('show');
        });

        // Update stats
        function updateStats() {
            document.getElementById('combosCreated').textContent = stats.combosCreated;
            document.getElementById('itemsViewed').textContent = stats.itemsViewed;
            document.getElementById('timeSpent').textContent = Math.floor(stats.timeSpent / 60) + 'm';
        }

        // Track time spent
        setInterval(() => {
            stats.timeSpent++;
            updateStats();
        }, 1000);

        // Update buy button when carousel changes
        function updateBuyButton() {
            const topItem = topCarousel.getCurrentItem();
            const bottomItem = bottomCarousel.getCurrentItem();
            const buyButton = document.getElementById('buyButton');
            const totalPrice = document.getElementById('totalPrice');
            
            if (topItem && bottomItem) {
                const topPrice = parseFloat(topItem.dataset.price);
                const bottomPrice = parseFloat(bottomItem.dataset.price);
                const total = topPrice + bottomPrice;
                
                totalPrice.textContent = `Total: $${total.toFixed(2)}`;
                totalPrice.style.display = 'block';
                buyButton.disabled = false;
            } else {
                totalPrice.style.display = 'none';
                buyButton.disabled = true;
            }
        }

        // Update buy button when carousel changes
        setInterval(updateBuyButton, 100);

        function buyTogether() {
            const topItem = topCarousel.getCurrentItem();
            const bottomItem = bottomCarousel.getCurrentItem();
            
            if (topItem && bottomItem) {
                stats.combosCreated++;
                updateStats();
                alert('Opening ATYR buy links!');
                window.open('https://atyr.com/buy/top', '_blank');
                window.open('https://atyr.com/buy/bottom', '_blank');
            }
        }

        document.getElementById('buyButton').addEventListener('click', buyTogether);

        // Quick actions
        document.getElementById('randomCombo').addEventListener('click', () => {
            const randomTop = Math.floor(Math.random() * topCarousel.totalItems);
            const randomBottom = Math.floor(Math.random() * bottomCarousel.totalItems);
            topCarousel.currentIndex = randomTop;
            bottomCarousel.currentIndex = randomBottom;
            topCarousel.updateCarousel();
            bottomCarousel.updateCarousel();
            showRandomAIPrompt();
        });

        document.getElementById('saveCombo').addEventListener('click', () => {
            const topItem = topCarousel.getCurrentItem();
            const bottomItem = bottomCarousel.getCurrentItem();
            
            if (topItem && bottomItem) {
                const combo = `${topItem.dataset.name} + ${bottomItem.dataset.name}`;
                alert(`Combo saved: ${combo}`);
            }
        });

        document.getElementById('shareCombo').addEventListener('click', () => {
            const topItem = topCarousel.getCurrentItem();
            const bottomItem = bottomCarousel.getCurrentItem();
            
            if (topItem && bottomItem) {
                const text = `Check out this ATYR combo: ${topItem.dataset.name} + ${bottomItem.dataset.name} for $${(parseFloat(topItem.dataset.price) + parseFloat(bottomItem.dataset.price)).toFixed(2)}`;
                navigator.clipboard.writeText(text).then(() => {
                    alert('Combo copied to clipboard!');
                });
            }
        });

        // Enter key support for AI search
        document.getElementById('aiSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('aiSearchBtn').click();
            }
        });

        // Initialize
        updateStats();
        
        // Show initial AI prompt
        setTimeout(() => {
            showRandomAIPrompt();
        }, 2000);
    </script>
</body>
</html>
